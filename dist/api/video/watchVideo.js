var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.watchVideo=void 0;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _axios=_interopRequireDefault(require("axios"));var isProd=process.env.NODE_ENV==="production";var cloudFrontDomain="https://dpz1evfcdl4g3.cloudfront.net";var s3BucketDomain="https://begenone-images.s3.us-east-1.amazonaws.com";var calculateTimeAgo=function calculateTimeAgo(timestamp){var timeDiff=Date.now()-new Date(timestamp).getTime();var minutes=Math.floor(timeDiff/60000);if(minutes<60)return`${minutes} minute(s) ago`;var hours=Math.floor(minutes/60);if(hours<24)return`${hours} hour(s) ago`;var days=Math.floor(hours/24);return`${days} day(s) ago`;};var watchVideo=exports.watchVideo=function(){var _ref2=(0,_asyncToGenerator2.default)(function*(_ref){var videoId=_ref.videoId,CHANNEL_API_URL=_ref.CHANNEL_API_URL,VIDEO_API_URL=_ref.VIDEO_API_URL;try{var videoRes=yield _axios.default.get(`${VIDEO_API_URL}/api/v1/videos/route-video/${videoId}`);var channelId=videoRes.data.data.channel;var channelRes=yield _axios.default.get(`${CHANNEL_API_URL}/api/v1/channels/channel-routes/${channelId}`);var channelData=channelRes.data.data;console.log(`Channel Response: `,channelData);var videosRes=yield _axios.default.get(`${VIDEO_API_URL}/api/v1/videos/route-video/`);var videoData=videoRes.data.data;var videosData=videosRes.data.data;var userId=channelData.user;var thumbnailMap=new Map(videosData.map(function(item){return[item.thumbnail,`${cloudFrontDomain}/${item.thumbnail}`];}));var filteredVideos=videosData.filter(function(videoD){return videoD.channel;});filteredVideos.forEach(function(videoD){videoD.videoTimeAgo=calculateTimeAgo(videoD.time);videoD.thumbnailUrl=videoD.thumbnail==="default-thumbnail.png"?`${s3BucketDomain}/default-thumbnail.png`:thumbnailMap.get(videoD.thumbnail)||null;var videoChannel=videoD.channel;videoD.channelLogoUrl=videoChannel?`${cloudFrontDomain}/${videoChannel.channelLogo}`:null;});var shuffleArray=function shuffleArray(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var _ref3=[array[j],array[i]];array[i]=_ref3[0];array[j]=_ref3[1];}};shuffleArray(filteredVideos);var limitedVideos=filteredVideos.slice(0,6);var isUserSubscribed=false;var videoUserData=videoData.user;if(userId&&videoUserData){var channelSubscribers=videoUserData.subscribedChannels||[];isUserSubscribed=channelSubscribers.includes(userId);}var shareLink=`${VIDEO_API_URL}/watch/${videoData._id}`;var btnText=isUserSubscribed?"Subscribed":"Subscribe";var btnClass=isUserSubscribed?"sect-mid-vdoP-subsBtn-done":"sect-mid-vdoP-subsBtn";return{videoData:videoData,cloudFrontVideoUrl:`${cloudFrontDomain}/${videoData.video}`,limitedVideos:limitedVideos,isUserSubscribed:isUserSubscribed,btnText:btnText,btnClass:btnClass,shareLink:shareLink,channelData:channelData,channelLogoUrl:videoData.channel?`${cloudFrontDomain}/${videoData.channel.channelLogo}`:null,videoTimeAgo:calculateTimeAgo(videoData.time)};}catch(err){console.error("Error in watchVideo API: ",err);throw new Error("Failed to load video data");}});return function watchVideo(_x){return _ref2.apply(this,arguments);};}();
var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.getOverview=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _axios=_interopRequireDefault(require("axios"));var _calculateTimeAgo=_interopRequireDefault(require("../../utils/calculateTimeAgo"));var cloudFrontDomain="https://dpz1evfcdl4g3.cloudfront.net";var s3BucketDomain="https://begenone-images.s3.us-east-1.amazonaws.com";var getOverview=exports.getOverview=function(){var _ref2=(0,_asyncToGenerator2.default)(function*(_ref){var VIDEO_API_URL=_ref.VIDEO_API_URL,CHANNEL_API_URL=_ref.CHANNEL_API_URL,GET_ALL_VIDEOS_ENDPOINT=_ref.GET_ALL_VIDEOS_ENDPOINT,GET_ALL_CHANNELS_ENDPOINT=_ref.GET_ALL_CHANNELS_ENDPOINT;try{var _yield$Promise$all=yield Promise.all([_axios.default.get(`${VIDEO_API_URL}${GET_ALL_VIDEOS_ENDPOINT}`),_axios.default.get(`${CHANNEL_API_URL}${GET_ALL_CHANNELS_ENDPOINT}`)]),_yield$Promise$all2=(0,_slicedToArray2.default)(_yield$Promise$all,2),videosRes=_yield$Promise$all2[0],channelsRes=_yield$Promise$all2[1];var videos=videosRes.data.data;var channels=channelsRes.data.data;var thumbnailMap=new Map(videos.map(function(item){return[item.thumbnail,`${cloudFrontDomain}/${item.thumbnail}`];}));var channelLogoMap=new Map(channels.map(function(channel){return[channel._id,channel.channelLogo?`${cloudFrontDomain}/${channel.channelLogo}`:null];}));var filteredVideos=videos.filter(function(video){return video.channel;});var enrichedVideos=filteredVideos.map(function(video){video.videoTimeAgo=(0,_calculateTimeAgo.default)(video.time);video.thumbUrl=!video.thumbnail||["default-thumbnail.jpeg","default-thumbnail.png"].includes(video.thumbnail)?`${s3BucketDomain}/default-thumbnail.png`:thumbnailMap.get(video.thumbnail)||null;var channelId=video.channel._id||video.channel;var logoUrl=channelLogoMap.get(channelId)||null;video.channelLogo=logoUrl;if(video.channel&&typeof video.channel==="object"){video.channel.channelLogo=logoUrl;}return video;});var shuffled=enrichedVideos.sort(function(){return 0.5-Math.random();});var limitedVideos=shuffled.slice(0,21);var featuredVideoId="673f74ba66154c6994b9460f";var featuredVideo=limitedVideos.find(function(v){return v._id===featuredVideoId;});var restVideos=limitedVideos.filter(function(v){return v._id!==featuredVideoId;});var sortedVideos=featuredVideo?[featuredVideo].concat((0,_toConsumableArray2.default)(restVideos)):restVideos;return{data:{videos:sortedVideos,channelLogos:Object.fromEntries(channelLogoMap)}};}catch(error){var _error$response;console.error("Get Overview Error:",(error==null?void 0:(_error$response=error.response)==null?void 0:_error$response.data)||(error==null?void 0:error.message)||error);throw error;}});return function getOverview(_x){return _ref2.apply(this,arguments);};}();